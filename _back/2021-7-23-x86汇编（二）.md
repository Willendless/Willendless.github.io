---
layout: "post"
title: x86汇编（二）实模式架构与硬件
category: 操作系统
author: LJR
tags:
    - x86
    - os
---
## 1. 地址空间

8086的地址空间如下

## 2. 启动

**处理器上电后首先执行BIOS中的指令。**

+ 8086启动: `cs`初始化为`0xFFFF`，`ip`初始化为`0`。因此，执行的第一条指令地址为`0xFFFF0`
+ 现代x86处理器: `cs`初始化为`0xF000`，`ip`初始化为`0xFFF0`。因此，低20位仍然是`0xFFFF0`
  + 此外，其余地址线也会被强制设置为高电平
  + **目的:** 让新的BIOS位于4GB（地址空间）的高端
  + **兼容:** 但是旧的BIOS地址空间（`0xF0000~0xFFFFF`）也仍然映射到BIOS

**BIOS将主引导扇区（LBA=0）加载到`0x0:0x7c00`。接着jmp跳转到`0x0:0x7c00`，因此CS值变为0。**

+ 主引导扇区代码的作用
  + 计算内核的位置
  + 把os自举代码加载到内存
  + 跳转到对应位置
+ OS自举代码
  + 加载os到内存
  + 执行内核

### 2.1. 磁盘结构

+ CHS: 磁头，磁道，扇区
+ LBA: 逻辑

### 2.2. 主引导记录 

+ 魔数: 0x55, 0xaa

### 2.5. 显存与显示模式

+ `0xB8000 ~ 0xBFFFF`: 因此段地址为`0xB800`
+ 文本模式
